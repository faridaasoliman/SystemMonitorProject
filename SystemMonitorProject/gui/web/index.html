<!DOCTYPE html>
<html>
<head>
  <title>System Monitoring Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>System Monitoring Dashboard</h1>
    <button onclick="run('live')">Live Monitor</button>
    <button onclick="run('report')">Generate Report</button>
    <button onclick="run('logs')">View Logs</button>
    <div id="metrics" class="metrics-grid" aria-live="polite">
      <div class="metric-card" id="cpu">
        <div class="metric-title">CPU</div>
        <div class="metric-value">--</div>
        <div class="metric-bar"><div class="metric-fill" style="width:0%"></div></div>
      </div>
      <div class="metric-card" id="memory">
        <div class="metric-title">Memory</div>
        <div class="metric-value">--</div>
        <div class="metric-bar"><div class="metric-fill" style="width:0%"></div></div>
      </div>
      <div class="metric-card" id="disk">
        <div class="metric-title">Disk</div>
        <div class="metric-value">--</div>
        <div class="metric-bar"><div class="metric-fill" style="width:0%"></div></div>
      </div>
      <div class="metric-card" id="network">
        <div class="metric-title">Network (KB/s)</div>
        <div class="metric-value">--</div>
      </div>
      <div class="metric-card" id="gpu">
        <div class="metric-title">GPU</div>
        <div class="metric-value">--</div>
        <div class="metric-bar"><div class="metric-fill" style="width:0%"></div></div>
      </div>
      <div class="metric-card" id="load">
        <div class="metric-title">Load</div>
        <div class="metric-value">--</div>
      </div>
    </div>
  </div>

<script>
function run(action) {
  fetch('/run?cmd=' + action);
  alert('Command sent: ' + action + '\n(Check terminal output)');
}
// Periodically fetch metrics from server or fallback to mock JSON
async function fetchMetrics() {
  try {
    let res = await fetch('/metrics');
    if (!res.ok) throw new Error('no /metrics');
    return await res.json();
  } catch (e) {
    // fallback to local mock for dev when server endpoint isn't available
    try {
      let res = await fetch('mock_metrics.json');
      if (!res.ok) throw e;
      return await res.json();
    } catch (err) {
      console.error('Metrics fetch failed', err);
      return null;
    }
  }
}

function updateMetricCard(id, value, opts = {}) {
  const card = document.getElementById(id);
  if (!card) return;
  const valueEl = card.querySelector('.metric-value');
  const fill = card.querySelector('.metric-fill');
  valueEl.textContent = opts.format ? opts.format(value) : value;
  if (fill && typeof value === 'number') {
    const pct = Math.max(0, Math.min(100, Math.round(value)));
    fill.style.width = pct + '%';
  }
}

async function poll() {
  const data = await fetchMetrics();
  if (!data) return;
  updateMetricCard('cpu', data.cpu_percent ?? '--', { format: v => v + '%' });
  updateMetricCard('memory', data.memory_percent ?? '--', { format: v => v + '%' });
  updateMetricCard('disk', data.disk_percent ?? '--', { format: v => v + '%' });
  updateMetricCard('network', data.network_kbps ?? '--', { format: v => v });
  updateMetricCard('gpu', data.gpu_percent ?? '--', { format: v => v + '%' });
  updateMetricCard('load', (data.load_avg ?? '--'));
}

// start polling
poll();
setInterval(poll, 5000);
</script>
</body>
</html>
